System.register(["@main"],(function(t,e){var s;return{setters:[function(t){}],execute:function(){s=class{constructor(t){this.el=t,this.icon=t.querySelector("i, span"),this.added="1"===t.dataset.added||"true"===t.dataset.added,this.type=t.dataset.type,this.id=t.dataset.id,this.el.addEventListener("click",(async()=>{await this.toggleFavorite(),this.refreshStyle()})),this.refreshStyle()}async toggleFavorite(){const t=u.data("favorite");if(!t.isLogin)return void(location.href=t.loginUri);const e=this.added?"removeFavorite":"addFavorite";try{const t=await u.$http.post(`@favorite_ajax/${e}`,{id:this.id,type:this.type});this.el.dispatchEvent(new CustomEvent("favorited",{detail:{favorited:!this.added,task:e,type:this.type,message:t.data.message},bubbles:!0})),this.added=!this.added,this.el.dataset.added=this.added?"1":"0"}catch(t){throw console.error(t),u.alert(t.message,"","warning"),t}}refreshStyle(){(this.el.dataset.classInactive||this.el.dataset.classActive)&&this.el.classList.remove(...this.classToList(this.el.dataset.classInactive),...this.classToList(this.el.dataset.classActive)),this.added?(this.icon.setAttribute("class",this.el.dataset.iconActive),this.el.dataset.classActive&&this.el.classList.add(...this.classToList(this.el.dataset.classActive)),this.el.setAttribute("data-bs-original-title",this.el.dataset.titleActive)):(this.icon.setAttribute("class",this.el.dataset.iconInactive),this.el.dataset.classInactive&&this.el.classList.add(...this.classToList(this.el.dataset.classInactive)),this.el.setAttribute("data-bs-original-title",this.el.dataset.titleInactive)),setTimeout((()=>{u.$ui.bootstrap.tooltip(this.el).update()}),50)}classToList(t){return t.split(" ")}},u.directive("favorite-button",{mounted(t){setTimeout((()=>{u.module(t,"favorite.button",(()=>new s(t)))}),0)}})}}}));
//# sourceMappingURL=favorite-button.js.map
