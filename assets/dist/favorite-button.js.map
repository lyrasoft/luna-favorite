{"version":3,"sources":["favorite-button.js"],"names":["System","register","_export","_context","FavoriteButton","setters","_main","execute","constructor","el","this","icon","querySelector","added","dataset","type","async","toggleFavorite","favData","refreshStyle","location","href","loginUri","u","$http","post","task","dispatchEvent","CustomEvent","detail","favorited","message","res","data","console","error","e","bubbles","classInactive","classActive","alert","remove","classToList","setAttribute","iconActive","titleActive","classList","add","setTimeout","className","split","directive","mounted","module"],"mappings":"AAAAA,OAAOC,SAAS,CAAC,UAAU,SAAUC,EAASC,GAG5C,IAMIC,EAAc,MAAA,CAAAC,QAAA,CAAA,SAAAC,GAAA,GAAAC,QAAA,WATpBH,EAAA,MACAI,YAAAC,GACAC,KAAAD,GAAAA,EACAC,KAAAC,KAAAF,EAAAG,cAAA,WACAF,KAAAG,MAAA,MAAAJ,EAAAK,QAAAD,OAAA,SAAAJ,EAAAK,QAAAD,MACAH,KAAAK,KAAAN,EAAAK,QAAAC,KAIMX,KAAAA,GAAcK,EAApBK,QAAMV,GACJI,KAAAA,GAAAA,iBAAgB,SAAAQ,gBACPN,KAAKO,iBACZP,KAAKC,cAAUC,IAEfF,KAAKK,cAKD,CACAC,uBACE,MAHJE,EAAWD,EAAAA,KAAAA,YAIP,IAHJC,EAAKC,QAGP,YAFEC,SAAAC,KAAAH,EAAAI,UAKJ,MAAML,EAAAA,KAAcA,MAAG,iBAAA,cACrB,IAEA,MAAKC,QAAeK,EAAEC,MAAAC,KAAA,kBAAAC,IAAA,CACpBN,GAAAA,KAASC,GACTN,KAAAL,KAAAK,OAGFL,KAAMgB,GAAIC,cAAa,IAAGC,YAAA,YAAmB,CAEzCC,OAAA,CACFC,WAAYpB,KAAQc,MAGdE,OACFX,KAAML,KAAKK,KAEdgB,QAAAC,EAAAC,KAAAF,SAIGF,SAAQ,KALNnB,KAOAgB,OAAIhB,KAAAG,MANJH,KAOAK,GAAID,QAAOC,MAAIL,KAAAG,MAAA,IAAA,GANjB,CAAE,MAOAkB,GAGJ,MATIG,QAODC,MAAAC,GANCb,EAOFc,MAAAA,EAAON,QAAE,GAAA,WAEZK,CAPG,CACF,CACAjB,gBAUFe,KAAOzB,GAAC0B,QAAQG,eAAA5B,KAAAD,GAAAK,QAAAyB,cAChBhB,KAAEiB,GAAMJ,UAASK,UAAM/B,KAAUgC,YAAAhC,KAAAD,GAAAK,QAAAwB,kBAAA5B,KAAAgC,YAAAhC,KAAAD,GAAAK,QAAAyB,cAEnC7B,KAAAG,OACFH,KAAAC,KAAAgC,aAAA,QAAAjC,KAAAD,GAAAK,QAAA8B,YAEAzB,KAAYV,GAAGK,QAAAyB,aACT7B,KAAKD,GAAGK,UAAQwB,OAAAA,KAAaI,YAAY5B,KAAAA,GAAQyB,QAAAA,cAKrD7B,KAAAD,GAAAkC,aAAA,yBAAAjC,KAAAD,GAAAK,QAAA+B,eAGEnC,KAAKC,KAAKgC,aAAa,QAASjC,KAAKD,GAAGK,QAAQ8B,cAE5ClC,KAAKD,GAAGK,QAAQyB,eAClB7B,KAAKD,GAAGqC,UAAUC,OACbrC,KAAKgC,YAAYhC,KAAKD,GAAGK,QAAQyB,gBAIxC7B,KAAKD,GAAGkC,aAAa,yBAA0BjC,KAAKD,GAAGK,QAAQ+B,gBAhB3DG,YAkBK,KAEGlC,EAAAA,IAAQwB,UAAAA,QAAe5B,KAAAD,IAC5BA,QAAGqC,GAGV,GApBE,CAEAJ,YAuBMO,GAtBJ,OAuBJA,EAAaC,MAAQ,IAtBnB,GAEF3B,EAuBJ4B,UAAA,kBAAA,CAtBMC,QAAQ3C,GAwBduC,YAAA,KACFzB,EAAA8B,OAAA5C,EAAA,mBAAA,IAAA,IAAAL,EAAAK,IAAA,GACA,EACA,GArBI,EAEJ","file":"favorite-button.js","sourcesContent":["/**\n * Part of shopgo project.\n *\n * @copyright  Copyright (C) 2023 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nimport '@main';\n\nclass FavoriteButton {\n  constructor(el) {\n    this.el = el;\n    this.icon = el.querySelector('i, span');\n    this.added = el.dataset.added === '1' || el.dataset.added === 'true';\n    this.type = el.dataset.type;\n    this.id = el.dataset.id;\n\n    this.el.addEventListener('click', async () => {\n      await this.toggleFavorite();\n      this.refreshStyle();\n    });\n\n    this.refreshStyle();\n  }\n\n  async toggleFavorite() {\n    const favData = u.data('favorite');\n\n    if (!favData.isLogin) {\n      location.href = favData.loginUri;\n      return;\n    }\n\n    const task = this.added ? 'removeFavorite' : 'addFavorite';\n\n    try {\n      const res = await u.$http.post(\n        `@favorite_ajax/${task}`,\n        {\n          id: this.id,\n          type: this.type,\n        }\n      );\n\n      this.el.dispatchEvent(\n        new CustomEvent('favorited', {\n          detail: {\n            favorited: !this.added,\n            task,\n            type: this.type,\n            message: res.data.message,\n          },\n          bubbles: true\n        })\n      );\n\n      this.added = !this.added;\n      this.el.dataset.added = this.added ? '1' : '0';\n    } catch (e) {\n      console.error(e);\n      u.alert(e.message, '', 'warning');\n      throw e;\n    }\n  }\n\n  refreshStyle() {\n    if (this.el.dataset.classInactive || this.el.dataset.classActive) {\n      this.el.classList.remove(\n        ...this.classToList(this.el.dataset.classInactive),\n        ...this.classToList(this.el.dataset.classActive)\n      );\n    }\n\n    if (this.added) {\n      this.icon.setAttribute('class', this.el.dataset.iconActive);\n\n      if (this.el.dataset.classActive) {\n        this.el.classList.add(\n          ...this.classToList(this.el.dataset.classActive)\n        );\n      }\n\n      this.el.setAttribute('data-bs-original-title', this.el.dataset.titleActive);\n    } else {\n      this.icon.setAttribute('class', this.el.dataset.iconInactive);\n\n      if (this.el.dataset.classInactive) {\n        this.el.classList.add(\n          ...this.classToList(this.el.dataset.classInactive)\n        );\n      }\n\n      this.el.setAttribute('data-bs-original-title', this.el.dataset.titleInactive);\n    }\n\n    setTimeout(() => {\n      const tooltip = u.$ui.bootstrap.tooltip(this.el);\n      tooltip.update();\n    }, 50);\n  }\n\n  /**\n   * @param {string} className\n   * @returns {string[]}\n   */\n  classToList(className) {\n    return className.split(' ');\n  }\n}\n\nu.directive(\n  'favorite-button',\n  {\n    mounted(el) {\n      setTimeout(() => {\n        u.module(el, 'favorite.button', () => new FavoriteButton(el));\n      }, 0);\n    }\n  }\n);\n"]}