{"version":3,"file":"favorite-button.js","names":["FavoriteButton","setters","_main","execute","constructor","el","icon","querySelector","added","dataset","type","id","addEventListener","toggleFavorite","refreshStyle","favData","u","data","isLogin","location","href","loginUri","task","res","$http","post","dispatchEvent","CustomEvent","detail","favorited","message","bubbles","e","console","error","alert","classInactive","classActive","classList","remove","classToList","setAttribute","iconActive","add","titleActive","iconInactive","titleInactive","setTimeout","tooltip","$ui","bootstrap","update","className","split","directive","mounted","module"],"sources":["favorite-button.js"],"sourcesContent":["/**\n * Part of shopgo project.\n *\n * @copyright  Copyright (C) 2023 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nimport '@main';\n\nclass FavoriteButton {\n  constructor(el) {\n    this.el = el;\n    this.icon = el.querySelector('i, span');\n    this.added = el.dataset.added === '1' || el.dataset.added === 'true';\n    this.type = el.dataset.type;\n    this.id = el.dataset.id;\n\n    this.el.addEventListener('click', async () => {\n      await this.toggleFavorite();\n      this.refreshStyle();\n    });\n\n    this.refreshStyle();\n  }\n\n  async toggleFavorite() {\n    const favData = u.data('favorite');\n\n    if (!favData.isLogin) {\n      location.href = favData.loginUri;\n      return;\n    }\n\n    const task = this.added ? 'removeFavorite' : 'addFavorite';\n\n    try {\n      const res = await u.$http.post(\n        `@favorite_ajax/${task}`,\n        {\n          id: this.id,\n          type: this.type,\n        }\n      );\n\n      this.el.dispatchEvent(\n        new CustomEvent('favorited', {\n          detail: {\n            favorited: !this.added,\n            task,\n            type: this.type,\n            message: res.data.message,\n          },\n          bubbles: true\n        })\n      );\n\n      this.added = !this.added;\n      this.el.dataset.added = this.added ? '1' : '0';\n    } catch (e) {\n      console.error(e);\n      u.alert(e.message, '', 'warning');\n      throw e;\n    }\n  }\n\n  refreshStyle() {\n    if (this.el.dataset.classInactive || this.el.dataset.classActive) {\n      this.el.classList.remove(\n        ...this.classToList(this.el.dataset.classInactive),\n        ...this.classToList(this.el.dataset.classActive)\n      );\n    }\n\n    if (this.added) {\n      this.icon.setAttribute('class', this.el.dataset.iconActive);\n\n      if (this.el.dataset.classActive) {\n        this.el.classList.add(\n          ...this.classToList(this.el.dataset.classActive)\n        );\n      }\n\n      this.el.setAttribute('data-bs-original-title', this.el.dataset.titleActive);\n    } else {\n      this.icon.setAttribute('class', this.el.dataset.iconInactive);\n\n      if (this.el.dataset.classInactive) {\n        this.el.classList.add(\n          ...this.classToList(this.el.dataset.classInactive)\n        );\n      }\n\n      this.el.setAttribute('data-bs-original-title', this.el.dataset.titleInactive);\n    }\n\n    setTimeout(() => {\n      const tooltip = u.$ui.bootstrap.tooltip(this.el);\n      tooltip.update();\n    }, 50);\n  }\n\n  /**\n   * @param {string} className\n   * @returns {string[]}\n   */\n  classToList(className) {\n    return className.split(' ');\n  }\n}\n\nu.directive(\n  'favorite-button',\n  {\n    mounted(el) {\n      setTimeout(() => {\n        u.module(el, 'favorite.button', () => new FavoriteButton(el));\n      }, 0);\n    }\n  }\n);\n"],"mappings":"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"}