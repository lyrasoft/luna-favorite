{"version":3,"file":"favorite-button.js","names":["FavoriteButton","setters","_main","execute","constructor","el","icon","querySelector","added","dataset","type","id","addEventListener","toggleFavorite","refreshStyle","task","res","u","$http","post","notify","data","message","e","console","error","alert","classInactive","classActive","classList","remove","classToList","setAttribute","iconActive","add","iconInactive","className","split","directive","mounted","setTimeout","module"],"sources":["favorite-button.js"],"sourcesContent":["/**\n * Part of shopgo project.\n *\n * @copyright  Copyright (C) 2023 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nimport '@main';\n\nclass FavoriteButton {\n  constructor(el) {\n    this.el = el;\n    this.icon = el.querySelector('i, span');\n    this.added = el.dataset.added === '1' || el.dataset.added === 'true';\n    this.type = el.dataset.type;\n    this.id = el.dataset.id;\n\n    this.el.addEventListener('click', async () => {\n      await this.toggleFavorite();\n      this.refreshStyle();\n    });\n\n    this.refreshStyle();\n  }\n\n  async toggleFavorite() {\n    const task = this.added ? 'removeFavorite' : 'addFavorite';\n\n    try {\n      const res = await u.$http.post(\n        `@favorite_ajax/${task}`,\n        {\n          id: this.id,\n          type: this.type,\n        }\n      );\n\n      u.notify(res.data.message);\n\n      this.added = !this.added;\n      this.el.dataset.added = this.added ? '1' : '0';\n    } catch (e) {\n      console.error(e);\n      u.alert(e.message, '', 'warning');\n      throw e;\n    }\n  }\n\n  refreshStyle() {\n    if (this.el.dataset.classInactive || this.el.dataset.classActive) {\n      this.el.classList.remove(\n        ...this.classToList(this.el.dataset.classInactive),\n        ...this.classToList(this.el.dataset.classActive)\n      );\n    }\n\n    if (this.added) {\n      this.icon.setAttribute('class', this.el.dataset.iconActive);\n\n      if (this.el.dataset.classActive) {\n        this.el.classList.add(\n          ...this.classToList(this.el.dataset.classActive)\n        );\n      }\n    } else {\n      this.icon.setAttribute('class', this.el.dataset.iconInactive);\n\n      if (this.el.dataset.classInactive) {\n        this.el.classList.add(\n          ...this.classToList(this.el.dataset.classInactive)\n        );\n      }\n    }\n  }\n\n  /**\n   * @param {string} className\n   * @returns {string[]}\n   */\n  classToList(className) {\n    return className.split(' ');\n  }\n}\n\nu.directive(\n  'favorite-button',\n  {\n    mounted(el) {\n      setTimeout(() => {\n        u.module(el, 'favorite.button', () => new FavoriteButton(el));\n      }, 0);\n    }\n  }\n);\n"],"mappings":"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"}